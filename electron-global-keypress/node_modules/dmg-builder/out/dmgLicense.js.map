{"version":3,"sources":["../src/dmgLicense.ts"],"names":[],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAUO,eAAe,eAAf,CAA+B,QAA/B,EAAgE,OAAhE,EAA+E;AACpF,QAAM,YAAY,GAAG,MAAM,gCAAgB,QAAhB,CAA3B;;AACA,MAAI,YAAY,CAAC,MAAb,KAAwB,CAA5B,EAA+B;AAC7B,WAAO,IAAP;AACD;;AAED,QAAM,kBAAkB,GAAG,MAAM,6CAAsB,QAAtB,CAAjC;AACA,EAAA,QAAQ,CAAC,WAAT,CAAqB,GAArB,CAAyB,kBAAzB,EAA6C,YAA7C;AACA,EAAA,QAAQ,CAAC,WAAT,CAAqB,GAArB,CAAyB,oBAAzB,EAA+C,kBAA/C;AAEA,QAAM,QAAQ,GAAkB;AAC9B,eAAW,sEADmB;AAE9B;AACA,IAAA,IAAI,EAAE,EAHwB;AAI9B,IAAA,MAAM,EAAE;AAJsB,GAAhC;;AAOA,OAAK,MAAM,IAAX,IAAmB,YAAnB,EAAiC;AAC/B,IAAA,QAAQ,CAAC,IAAT,CAAc,IAAd,CAAmB;AACjB,MAAA,IAAI,EAAE,IAAI,CAAC,IADM;AAEjB,MAAA,IAAI,EAAE,IAAI,CAAC,cAAL,CAAoB,OAApB,CAA4B,GAA5B,EAAiC,GAAjC;AAFW,KAAnB;AAID;;AAED,OAAK,MAAM,MAAX,IAAqB,kBAArB,EAAyC;AACvC,UAAM,QAAQ,GAAG,MAAM,CAAC,IAAxB;AACA,UAAM,KAAK,GAAG,QAAQ,CAAC,QAAT,CAAkB,MAAlB,IAA4B,oBAAK,MAAM,yBAAS,QAAT,EAAmB,OAAnB,CAAX,CAA5B,GAAsE,MAAM,yBAAS,QAAT,CAA1F;;AACA,QAAI,KAAK,CAAC,WAAV,EAAuB;AACrB;AACA,MAAA,KAAK,CAAC,OAAN,GAAgB,KAAK,CAAC,WAAtB;AACA,aAAO,KAAK,CAAC,WAAb;AACD;;AACD,IAAA,QAAQ,CAAC,MAAT,CAAgB,IAAhB,CAAqB,MAAM,CAAC,MAAP,CACnB;AACE,MAAA,IAAI,EAAE,MAAM,CAAC,cAAP,CAAsB,OAAtB,CAA8B,GAA9B,EAAmC,GAAnC;AADR,KADmB,EAInB,KAJmB,CAArB;AAMD;;AAED,QAAM,sCAAmB,OAAnB,EAA4B,QAA5B,EAAsC;AAC1C,IAAA,eAAe,EAAE,mBAAI,IAAJ,CAAS,IAAT,CAAc,kBAAd;AADyB,GAAtC,CAAN;AAIA,SAAO,QAAP;AACD,C","sourcesContent":["import { log } from \"builder-util\"\nimport { load } from 'js-yaml'\nimport { PlatformPackager } from \"app-builder-lib\"\nimport { getLicenseFiles } from \"app-builder-lib/out/util/license\"\nimport { readFile, readJson } from \"fs-extra\"\nimport { getLicenseButtonsFile } from \"./licenseButtons\"\nimport { dmgLicenseFromJSON } from 'dmg-license'\n\n// License Specifications\n// https://github.com/argv-minus-one/dmg-license/blob/HEAD/docs/License%20Specifications.md\ntype LicenseConfig = {\n  '$schema': string\n  body: any[]\n  labels: any[]\n}\n\nexport async function addLicenseToDmg(packager: PlatformPackager<any>, dmgPath: string): Promise<LicenseConfig | null> {\n  const licenseFiles = await getLicenseFiles(packager)\n  if (licenseFiles.length === 0) {\n    return null\n  }\n\n  const licenseButtonFiles = await getLicenseButtonsFile(packager)\n  packager.debugLogger.add(\"dmg.licenseFiles\", licenseFiles)\n  packager.debugLogger.add(\"dmg.licenseButtons\", licenseButtonFiles)\n\n  const jsonFile: LicenseConfig = {\n    \"$schema\": \"https://github.com/argv-minus-one/dmg-license/raw/master/schema.json\",\n    // defaultLang: '',\n    body: [],\n    labels: []\n  }\n\n  for (const file of licenseFiles) {\n    jsonFile.body.push({\n      file: file.file,\n      lang: file.langWithRegion.replace('_', '-')\n    })\n  }\n\n  for (const button of licenseButtonFiles) {\n    const filepath = button.file\n    const label = filepath.endsWith(\".yml\") ? load(await readFile(filepath, \"utf-8\")) : await readJson(filepath)\n    if (label.description) {\n      // to support original button file format\n      label.message = label.description\n      delete label.description\n    }\n    jsonFile.labels.push(Object.assign(\n      {\n        lang: button.langWithRegion.replace('_', '-')\n      },\n      label\n    ))\n  }\n\n  await dmgLicenseFromJSON(dmgPath, jsonFile, {\n    onNonFatalError: log.warn.bind(log)\n  })\n\n  return jsonFile\n}\n"],"sourceRoot":""}
